---
import { Menu, X, Linkedin } from "lucide-astro";

const pathname = new URL(Astro.request.url).pathname;

const isActive = (path: string) => {
  if (path === "/") return pathname === "/";
  return pathname.startsWith(path);
};

const cvPath = "/Cv-Carre-Arthur.pdf";

const navLinks = [
  { label: "MES PROJETS", path: "/work" },
  { label: "MON CV", path: cvPath },
];
---

<header
  class="relative w-full z-50 px-6 py-6 md:px-12 flex justify-between items-center transition-all duration-300"
  id="main-header"
>
  <div
    class="absolute inset-0 bg-[#2F5D62] border-b border-[#E7DED9]/10 shadow-sm z-0"
  >
  </div>

  <div class="z-50 relative">
    <a
      href="/"
      class="text-2xl font-bold title-font uppercase leading-none group text-[#E7DED9] transition-transform duration-300 hover:scale-[1.02]"
    >
      Arthur Carr√©
    </a>
  </div>

  <nav class="hidden md:block z-50 relative">
    <ul class="flex items-center gap-10 text-base font-bold uppercase">
      {
        navLinks.map((link) => (
          <li class="flex items-center">
            <a
              href={link.path}
              class={`nav-link transition-all duration-300 ${
                isActive(link.path) ? "is-active" : ""
              } ${
                link.path === cvPath
                  ? "border border-[#E7DED9]/20 bg-[#E7DED9] text-[#2F5D62] rounded-full px-5 py-2 hover:bg-[#2F5D62] hover:text-[#E7DED9]"
                  : "text-[#E7DED9]"
              }`}
              download={link.path === cvPath}
            >
              {link.label}
            </a>
          </li>
        ))
      }
    </ul>
  </nav>

  <button
    id="burger-btn"
    class="md:hidden z-50 relative group w-10 h-10 flex items-center justify-center cursor-pointer text-[#E7DED9]"
    aria-label="Menu"
  >
    <div class="icon-menu absolute inset-0 flex items-center justify-center">
      <Menu class="w-8 h-8" />
    </div>
    <div
      class="icon-close absolute inset-0 flex items-center justify-center opacity-0 scale-50 text-[#2F5D62]"
    >
      <X class="w-8 h-8" />
    </div>
  </button>

  <div
    id="mobile-menu"
    class="fixed inset-0 bg-[#E7DED9] z-40 flex flex-col items-center justify-center px-6 translate-x-full md:hidden"
  >
    <nav class="flex flex-col gap-12 w-full items-center justify-center">
      {
        navLinks.map((link, index) => (
          <a
            href={link.path}
            class="mobile-link group flex flex-col items-center justify-center opacity-0 translate-y-10 no-underline"
            download={link.path === cvPath}
          >
            <span class="font-mono text-[#2F5D62] text-lg mb-2 opacity-70">
              0{index + 1}
            </span>
            <span class="text-[12vw] font-bold title-font uppercase leading-[0.9] text-[#2F5D62] text-center transition-transform duration-300 group-hover:scale-105">
              {link.label}
            </span>
          </a>
        ))
      }
    </nav>

    <div class="absolute bottom-12 w-full flex justify-center">
      <a
        href="https://www.linkedin.com/in/arthur-carr%C3%A9-1b63aa307/"
        target="_blank"
        class="social-link opacity-0 translate-y-4 transition-all duration-300 hover:scale-110"
      >
        <Linkedin class="w-10 h-10 text-[#2F5D62]" stroke-width="1.5" />
      </a>
    </div>
  </div>
</header>

<script>
  import gsap from "gsap";

  const burgerBtn = document.getElementById("burger-btn");
  const mobileMenu = document.getElementById("mobile-menu");
  const mobileLinks = document.querySelectorAll(".mobile-link");
  const socialLink = document.querySelector(".social-link");
  const iconMenu = burgerBtn?.querySelector(".icon-menu");
  const iconClose = burgerBtn?.querySelector(".icon-close");

  let isMenuOpen = false;

  burgerBtn?.addEventListener("click", () => {
    isMenuOpen = !isMenuOpen;

    if (isMenuOpen) {
      // Animation Icons
      if (iconMenu)
        gsap.to(iconMenu, {
          opacity: 0,
          rotation: 90,
          scale: 0.5,
          duration: 0.3,
        });
      if (iconClose)
        gsap.to(iconClose, {
          opacity: 1,
          rotation: 0,
          scale: 1,
          duration: 0.3,
        });

      // Menu Slide
      if (mobileMenu)
        gsap.to(mobileMenu, { x: "0%", duration: 0.6, ease: "expo.out" });

      // Links Stagger
      if (mobileLinks.length)
        gsap.to(mobileLinks, {
          opacity: 1,
          y: 0,
          duration: 0.6,
          stagger: 0.1,
          delay: 0.2,
          ease: "power3.out",
        });

      if (socialLink)
        gsap.to(socialLink, {
          opacity: 1,
          y: 0,
          duration: 0.5,
          delay: 0.5,
          ease: "back.out(1.7)",
        });

      document.body.style.overflow = "hidden";
    } else {
      if (iconMenu)
        gsap.to(iconMenu, { opacity: 1, rotation: 0, scale: 1, duration: 0.3 });
      if (iconClose)
        gsap.to(iconClose, {
          opacity: 0,
          rotation: -90,
          scale: 0.5,
          duration: 0.3,
        });

      if (mobileMenu)
        gsap.to(mobileMenu, { x: "100%", duration: 0.5, ease: "power3.in" });
      if (mobileLinks.length || socialLink)
        gsap.to([mobileLinks, socialLink], {
          opacity: 0,
          y: 20,
          duration: 0.2,
        });

      document.body.style.overflow = "";
    }
  });

  // Fermer le menu au clic sur un lien
  mobileLinks.forEach((link) => {
    link.addEventListener("click", () => {
      if (isMenuOpen) burgerBtn?.click();
    });
  });
</script>

<style>
  /* --- Desktop Links --- */
  .nav-link {
    position: relative;
    display: inline-flex;
    align-items: center;
  }

  .nav-link:not(.border)::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: -6px;
    height: 2px;
    width: 100%;
    background: #e7ded9;
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.3s ease;
  }

  .nav-link:not(.border):hover::after,
  .nav-link.is-active:not(.border)::after {
    transform: scaleX(1);
  }

  /* --- CV Button Styles --- */
  .nav-link.border {
    transition: all 0.3s ease;
  }

  .nav-link.border:hover {
    background-color: #e7ded9;
    color: #2f5d62;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  /* --- Utilities --- */
  .title-font {
    letter-spacing: -0.02em;
  }
</style>
