---
import Layout from "../layouts/Layout.astro";
import ProjectCard from "../components/ProjectCard.astro";
import { projects } from "../data/projects";
---

<Layout title="Projets | Portfolio">
  <main class="px-6 md:px-12 pt-24 md:pt-36 pb-24">
    <!-- Header page -->
    <div class="mb-14 md:mb-20" data-reveal>
      <h1
        class="text-[48px] sm:text-[64px] md:text-[72px] font-bold title-font uppercase -tighter text-title leading-[0.9]"
      >
        mes projets
      </h1>

      <div class="mt-6 md:mt-8 flex items-center justify-between gap-6">
        <p class="text-base text-theme max-w-xl">
          Voici une sélection de projets en design, web et marketing
        </p>

        <span
          class="hidden md:inline-flex text-base font-bold uppercase text-theme opacity-80"
        >
          {projects.length} projets
        </span>
      </div>
    </div>

    <!-- Grid projets -->
    <div
      class="grid grid-cols-1 md:grid-cols-2 gap-x-4 md:gap-x-12 gap-y-12 md:gap-y-20"
    >
      {
        projects.map((project, index) => (
          <div class={`${index % 2 !== 0 ? "md:mt-16" : ""}`} data-reveal>
            <ProjectCard
              title={project.title}
              category={project.category}
              year={project.year}
              image={project.cover}
              tags={project.tags ?? []}
              slug={project.slug}
            />
          </div>
        ))
      }
    </div>
  </main>
</Layout>

<script>
  const reduceMotion =
    window.matchMedia &&
    window.matchMedia("(prefers-reduced-motion: reduce)").matches;

  const items = document.querySelectorAll("[data-reveal]");

  if (!reduceMotion) {
    // état initial
    items.forEach((el) => el.classList.add("reveal-init"));

    const io = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("reveal-in");
            io.unobserve(entry.target); // une seule fois (propre)
          }
        });
      },
      {
        threshold: 0.12,
        rootMargin: "0px 0px -10% 0px", // déclenche un poil avant
      },
    );

    items.forEach((el) => io.observe(el));
  }
</script>

<style>
  /* Espacements ajustés déjà (gap-y réduit + mt colonne droite réduit) */

  /* Anim reveal pro (sans GSAP) */
  .reveal-init {
    opacity: 0;
    transform: translateY(18px);
    filter: blur(8px);
    transition:
      opacity 650ms cubic-bezier(0.22, 1, 0.36, 1),
      transform 650ms cubic-bezier(0.22, 1, 0.36, 1),
      filter 650ms cubic-bezier(0.22, 1, 0.36, 1);
    will-change: opacity, transform, filter;
  }

  .reveal-init.reveal-in {
    opacity: 1;
    transform: translateY(0);
    filter: blur(0);
  }

  /* Accessibilité: si reduce motion, rien ne bouge */
  @media (prefers-reduced-motion: reduce) {
    .reveal-init {
      transition: none !important;
      transform: none !important;
      filter: none !important;
      opacity: 1 !important;
    }
  }
</style>
