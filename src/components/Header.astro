---
import { Menu, X, Linkedin } from "lucide-astro";

const pathname = new URL(Astro.request.url).pathname;

const isActive = (path: string) => {
  if (path === "/") return pathname === "/";
  return pathname.startsWith(path);
};

// ✅ CV accessible depuis /public
const cvPath = "/Cv-Carre-Arthur.pdf";

const navLinks = [
  { label: "MES PROJETS", path: "/work" },
  { label: "MON CV", path: cvPath },
];
---

<header
  class="relative w-full z-50 px-6 py-6 md:px-12 flex justify-between items-center transition-all duration-300 mix-blend-normal"
  id="main-header"
>
  <div
    class="absolute inset-0 bg-[#1030E0] border-b border-white/10 shadow-sm z-0"
  >
  </div>

  <div class="z-50 relative">
    <a
      href="/"
      class="text-xl font-bold title-font uppercase -tighter leading-none group text-white transition-transform duration-300 hover:scale-[1.02]"
    >
      Arthur Carré
    </a>
  </div>

  <nav class="hidden md:block z-50 relative">
    <ul class="flex items-center gap-10 text-sm font-bold uppercase">
      {
        navLinks.map((link) => (
          <li class="flex items-center">
            <a
              href={link.path}
              class={`nav-link transition-all duration-300 ${
                isActive(link.path) ? "is-active" : ""
              } ${
                link.path === cvPath
                  ? "border border-white/20 bg-white text-[#1030E0] rounded-full px-5 py-2 hover:bg-[#1030E0] hover:text-white"
                  : "text-white"
              }`}
              download={link.path === cvPath}
            >
              {link.label}
            </a>
          </li>
        ))
      }
    </ul>
  </nav>

  <button
    id="burger-btn"
    class="md:hidden z-50 relative group w-8 h-8 flex items-center justify-center cursor-pointer text-white transition-transform duration-300 hover:scale-110"
    aria-label="Menu"
  >
    <div class="icon-menu absolute inset-0 flex items-center justify-center">
      <Menu class="w-8 h-8" />
    </div>

    <div
      class="icon-close absolute inset-0 flex items-center text-[#1030E0] justify-center opacity-0 scale-50"
    >
      <X class="w-8 h-8" />
    </div>
  </button>

  <div
    id="mobile-menu"
    class="fixed inset-0 bg-theme z-40 flex flex-col items-center justify-between px-6 py-12 translate-x-full transition-none md:hidden"
  >
    <div class="flex-1"></div>

    <nav
      class="flex flex-col gap-10 w-full max-w-lg mx-auto justify-center items-center"
    >
      {
        navLinks.map((link, index) => (
          <a
            href={link.path}
            class="mobile-link group flex items-start gap-6 opacity-0 translate-y-10 w-full justify-center"
            download={link.path === cvPath}
          >
            <span class="font-mono text-[#1030E0] text-lg md:text-xl mt-2 md:mt-4">
              0{index + 1}
            </span>

            <span class="text-[13vw] font-bold title-font uppercase -tighter leading-[0.85] text-[#1030E0] group-hover:text-[#1030E0] transition-colors duration-300 whitespace-nowrap text-center">
              {link.label}
            </span>
          </a>
        ))
      }
    </nav>

    <div class="flex-1 flex items-end justify-center w-full pb-8">
      <a
        href="https://www.linkedin.com/in/arthur-carr%C3%A9-1b63aa307/"
        target="_blank"
        class="social-link opacity-0 translate-y-4 transition-all duration-300 hover:scale-110"
      >
        <Linkedin class="w-10 h-10 text-[#1030E0]" stroke-width="1.5" />
      </a>
    </div>
  </div>
</header>

<script>
  import gsap from "gsap";

  const burgerBtn = document.getElementById("burger-btn");
  const mobileMenu = document.getElementById("mobile-menu");
  const mobileLinks = document.querySelectorAll(".mobile-link");
  const socialLink = document.querySelector(".social-link");

  const iconMenu = burgerBtn?.querySelector(".icon-menu");
  const iconClose = burgerBtn?.querySelector(".icon-close");

  let isMenuOpen = false;

  burgerBtn?.addEventListener("click", () => {
    isMenuOpen = !isMenuOpen;

    if (isMenuOpen) {
      // --- OUVERTURE ---
      if (iconMenu && iconClose) {
        gsap.to(iconMenu, {
          opacity: 0,
          rotation: 90,
          scale: 0.5,
          duration: 0.3,
        });
        gsap.to(iconClose, {
          opacity: 1,
          rotation: 0,
          scale: 1,
          duration: 0.3,
        });
      }

      gsap.to(mobileMenu, { x: "0%", duration: 0.5, ease: "power3.inOut" });

      gsap.to(mobileLinks, {
        opacity: 1,
        y: 0,
        duration: 0.5,
        stagger: 0.1,
        delay: 0.2,
        ease: "power2.out",
      });

      if (socialLink) {
        gsap.to(socialLink, {
          opacity: 1,
          y: 0,
          duration: 0.5,
          delay: 0.4,
          ease: "back.out(1.7)",
        });
      }

      document.body.style.overflow = "hidden";
    } else {
      // --- FERMETURE ---
      if (iconMenu && iconClose) {
        gsap.to(iconMenu, { opacity: 1, rotation: 0, scale: 1, duration: 0.3 });
        gsap.to(iconClose, {
          opacity: 0,
          rotation: -90,
          scale: 0.5,
          duration: 0.3,
        });
      }

      gsap.to(mobileMenu, { x: "100%", duration: 0.5, ease: "power3.inOut" });

      gsap.to(mobileLinks, { opacity: 0, y: 10, duration: 0.2 });

      if (socialLink) {
        gsap.to(socialLink, { opacity: 0, y: 10, duration: 0.2 });
      }

      document.body.style.overflow = "";
    }
  });

  mobileLinks.forEach((link) => {
    link.addEventListener("click", () => {
      if (isMenuOpen) burgerBtn?.click();
    });
  });
</script>

<style>
  /* Hover UX/UI des liens desktop (underline animé) */
  .nav-link {
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    transform: translateZ(0);
  }

  .nav-link::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: -8px;
    height: 3px;
    width: 100%;
    background: white;
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 300ms ease;
    border-radius: 999px;
    opacity: 0.9;
  }

  .nav-link:hover::after {
    transform: scaleX(1);
  }

  /* Petit effet "lift" au hover */
  .nav-link:hover {
    transform: translateY(-2px);
  }

  /* État actif: underline visible */
  .nav-link.is-active::after {
    transform: scaleX(1);
  }

  /* ----------------------------- */
  /* MON CV : hover plus discret   */
  /* ----------------------------- */

  /* Pas d'underline animé pour le bouton CV */
  .nav-link.border::after,
  .nav-link.border:hover::after,
  .nav-link.border.is-active::after {
    display: none;
  }

  /* Pas de "lift" global sur le bouton CV */
  .nav-link.border:hover {
    transform: none;
  }

  /* Remplace par un effet subtil */
  .nav-link.border {
    box-shadow: none;
    transition:
      background-color 200ms ease,
      filter 200ms ease,
      opacity 200ms ease;
  }

  .nav-link.border:hover {
    background-color: #2a2a2a;
    filter: brightness(1.05);
  }

  /* Focus clavier propre */
  .nav-link.border:focus-visible {
    outline: 2px solid rgba(192, 240, 0, 0.9);
    outline-offset: 3px;
  }
</style>
