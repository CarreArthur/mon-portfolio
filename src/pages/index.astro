---
import Layout from "../layouts/Layout.astro";
import Hero from "../components/Hero.astro";
import ProjectCard from "../components/ProjectCard.astro";
import { projects } from "../data/projects";

// On affiche les 2 premiers projets
const featuredProjects = projects.slice(0, 2);
---

<Layout title="Arthur Carré | MMI Student & Web Marketing Assistant">
  <Hero />

  <section
    class="px-6 md:px-12 py-12 md:py-12 border-t border-theme-10 bg-theme"
    data-reveal-section
  >
    <div
      class="flex flex-col md:flex-row justify-between items-start md:items-end mb-20 md:mb-32 gap-8"
    >
      <h2
        class="text-6xl md:text-8xl font-bold title-font uppercase leading-[0.85] text-title"
        data-reveal="title"
      >
        Mes <span class="text-title">Projets</span>
      </h2>

      <a
        href="/work"
        class="projects-cta group flex items-center gap-3 text-sm font-bold uppercase text-theme hover:text-title transition-colors duration-300 pb-2"
        data-reveal="cta"
      >
        Voir tous les projets
        <span
          class="arrow group-hover:translate-x-2 transition-transform duration-300"
          >→</span
        >
      </a>
    </div>

    <div
      class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-16 md:gap-y-32"
      data-reveal="grid"
    >
      {
        featuredProjects.map((project, i) => (
          <div class={i % 2 !== 0 ? "md:mt-32" : ""} data-reveal="card">
            <ProjectCard
              {...project}
              image={project.cover}
              tags={project.tags || []}
            />
          </div>
        ))
      }
    </div>
  </section>
</Layout>

<script>
  import gsap from "gsap";
  import ScrollTrigger from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  // Respect du "reduce motion"
  const reduceMotion =
    window.matchMedia &&
    window.matchMedia("(prefers-reduced-motion: reduce)").matches;

  if (!reduceMotion) {
    const section = document.querySelector("[data-reveal-section]");
    const title = document.querySelector('[data-reveal="title"]');
    const cta = document.querySelector('[data-reveal="cta"]');
    const cards = gsap.utils.toArray('[data-reveal="card"]');

    // 1) Intro section (titre + CTA)
    if (section && title) {
      gsap.set([title, cta], { opacity: 0, y: 22, filter: "blur(6px)" });

      gsap.to(title, {
        opacity: 1,
        y: 0,
        filter: "blur(0px)",
        duration: 0.75,
        ease: "power3.out",
        scrollTrigger: {
          trigger: section,
          start: "top 80%",
          toggleActions: "play none none reverse",
        },
      });

      if (cta) {
        gsap.to(cta, {
          opacity: 1,
          y: 0,
          filter: "blur(0px)",
          duration: 0.65,
          delay: 0.08,
          ease: "power3.out",
          scrollTrigger: {
            trigger: section,
            start: "top 78%",
            toggleActions: "play none none reverse",
          },
        });
      }
    }

    // 2) Cards reveal au scroll (stagger propre, sans parallax)
    if (cards.length) {
      gsap.set(cards, { opacity: 0, y: 34, filter: "blur(8px)" });

      gsap.to(cards, {
        opacity: 1,
        y: 0,
        filter: "blur(0px)",
        duration: 0.85,
        ease: "power3.out",
        stagger: 0.12,
        scrollTrigger: {
          trigger: section,
          start: "top 70%",
          toggleActions: "play none none reverse",
        },
      });
    }
  }
</script>

<style>
  /* Optionnel: aide la perf (GPU) sur éléments animés */
  [data-reveal="title"],
  [data-reveal="cta"],
  [data-reveal="card"] {
    will-change: transform, opacity, filter;
  }

  /* ----------------------------- */
  /* CTA "Voir tous les projets"   */
  /* Effet hover plus stylé & pro  */
  /* ----------------------------- */
  .projects-cta {
    position: relative;
    display: inline-flex;
    align-items: center;
    transform: translateZ(0);
  }

  /* underline "premium" (barre qui se dessine) */
  .projects-cta::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: -6px;
    width: 100%;
    height: 2px;
    background: currentColor;
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 280ms ease;
    border-radius: 999px;
    opacity: 0.75;
  }

  .projects-cta:hover::after {
    transform: scaleX(1);
  }

  /* petit lift très discret */
  .projects-cta:hover {
    transform: translateY(-1px);
  }

  /* flèche : un poil plus "snappy" */
  .projects-cta .arrow {
    transition: transform 280ms ease;
  }

  /* focus clavier */
  .projects-cta:focus-visible {
    outline: 2px solid currentColor;
    outline-offset: 4px;
    border-radius: 6px;
  }
</style>
