---
import Layout from "../../layouts/Layout.astro";
import { projects } from "../../data/projects";
import { Image } from "astro:assets";

export function getStaticPaths() {
  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

const { project } = Astro.props;
---

<Layout title={project.title + " | Portfolio"}>
  <main class="min-h-screen pb-32">
    <section
      class="px-6 md:px-12 pt-32 md:pt-48 pb-12 border-b border-theme-10"
    >
      <h1
        class="text-[10vw] font-bold title-font uppercase leading-[0.85] -tighter mb-12"
        style="color:#1E1E1E;"
      >
        {project.title}
      </h1>

      <div class="grid grid-cols-2 md:grid-cols-4 gap-8 text-sm">
        <div>
          <p class="uppercase text-xs mb-2" style="color: rgba(30,30,30,0.6);">
            Client
          </p>
          {
            project.clientLogo ? (
              <Image
                src={project.clientLogo}
                alt={project.client}
                height={32}
                loading="lazy"
                class="h-8 w-auto object-contain opacity-90"
              />
            ) : (
              <p style="color:#1E1E1E;">{project.client}</p>
            )
          }
        </div>

        <div>
          <p class="uppercase text-xs mb-2" style="color: rgba(30,30,30,0.6);">
            Rôle
          </p>
          <p style="color:#1E1E1E;">{project.role}</p>
        </div>

        <div>
          <p class="uppercase text-xs mb-2" style="color: rgba(30,30,30,0.6);">
            Année
          </p>
          <p style="color:#1E1E1E;">{project.year}</p>
        </div>

        {
          project.website && (
            <div>
              <p
                class="uppercase text-xs mb-2"
                style="color: rgba(30,30,30,0.6);"
              >
                Projet
              </p>
              <a
                href={project.website}
                target="_blank"
                rel="noreferrer noopener"
                class="project-link inline-flex items-center gap-2 text-xs font-semibold uppercase"
                style="color:#1E1E1E;"
              >
                Voir le projet <span class="arrow">→</span>
              </a>
            </div>
          )
        }
      </div>
    </section>

    <section class="px-6 md:px-12 py-12 md:py-24 grid md:grid-cols-12 gap-12">
      <div class="md:col-span-4 h-fit md:sticky md:top-32">
        <h2 class="text-xs uppercase mb-6 title-font" style="color:#1E1E1E;">
          À propos du projet
        </h2>

        <p
          class="text-xl leading-relaxed font-medium mb-8"
          style="color:#1E1E1E;"
        >
          {project.description}
        </p>

        {
          project.website && (
            <a
              href={project.website}
              target="_blank"
              rel="noreferrer noopener"
              class="inline-flex items-center gap-2 text-xs font-bold uppercase title-font px-4 py-2 rounded-full transition-colors mb-8"
              style="background-color:#C0F000;color:#1E1E1E;"
            >
              Voir le projet en ligne
            </a>
          )
        }

        {
          project.technologies && project.technologies.length > 0 && (
            <div class="mb-12">
              <h3
                class="text-xs uppercase mb-4 title-font"
                style="color:#1E1E1E;"
              >
                Technologies
              </h3>

              <div class="flex flex-wrap gap-4">
                {project.technologies.map((tech) => (
                  <div class="tech" title={tech.name}>
                    <Image
                      src={tech.icon}
                      alt={tech.name}
                      width={32}
                      height={32}
                      loading="lazy"
                      class="w-8 h-8 object-contain opacity-70 transition-opacity duration-200"
                    />
                    <span class="tech-label">{tech.name}</span>
                  </div>
                ))}
              </div>
            </div>
          )
        }

        <a
          href="/work"
          class="back-link block text-xs uppercase font-bold title-font w-fit"
          style="color:#1E1E1E;"
        >
          ← Retour aux projets
        </a>
      </div>

      <div class="md:col-span-8 flex flex-col gap-8">
        {
          project.gallery.map((img) => (
            <Image
              src={img}
              alt={project.title}
              loading="lazy"
              width={1200}
              class="w-full h-auto object-cover bg-panel"
            />
          ))
        }
      </div>
    </section>
  </main>
</Layout>

<style>
  /* ----------------------------- */
  /* Hover "Voir le projet" (pro)  */
  /* ----------------------------- */
  .project-link {
    position: relative;
    padding-bottom: 4px;
    transition: opacity 200ms ease;
  }

  .project-link::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: 0px;
    width: 100%;
    height: 2px;
    background: #c0f000;
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 260ms ease;
    border-radius: 999px;
    opacity: 0.95;
  }

  .project-link:hover {
    opacity: 0.92;
  }

  .project-link:hover::after {
    transform: scaleX(1);
  }

  .project-link .arrow {
    transition: transform 240ms ease;
  }

  .project-link:hover .arrow {
    transform: translateX(4px);
  }

  /* ------------------------------------ */
  /* Tech logos : afficher le nom au hover */
  /* ------------------------------------ */
  .tech {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .tech:hover img {
    opacity: 1;
  }

  .tech-label {
    position: absolute;
    left: 50%;
    top: -12px;
    transform: translate(-50%, -100%);
    white-space: nowrap;
    padding: 6px 10px;
    border-radius: 999px;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.02em;
    text-transform: uppercase;
    background: rgba(30, 30, 30, 0.92);
    color: #ffffff;

    opacity: 0;
    pointer-events: none;
    transition:
      opacity 180ms ease,
      transform 180ms ease;
  }

  .tech:hover .tech-label {
    opacity: 1;
    transform: translate(-50%, calc(-100% - 4px));
  }

  .tech-label::after {
    content: "";
    position: absolute;
    left: 50%;
    bottom: -6px;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-top: 6px solid rgba(30, 30, 30, 0.92);
  }

  /* ------------------------------------ */
  /* Hover "Retour aux projets" (pareil)  */
  /* ------------------------------------ */
  .back-link {
    position: relative;
    padding-bottom: 4px;
    opacity: 0.9;
    transition: opacity 200ms ease;
  }

  .back-link::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: 0px;
    width: 100%;
    height: 2px;
    background: #c0f000;
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 260ms ease;
    border-radius: 999px;
    opacity: 0.95;
  }

  .back-link:hover {
    opacity: 1;
  }

  .back-link:hover::after {
    transform: scaleX(1);
  }

  /* Focus clavier */
  .project-link:focus-visible,
  .back-link:focus-visible {
    outline: 2px solid rgba(192, 240, 0, 0.9);
    outline-offset: 4px;
    border-radius: 6px;
  }
</style>
